<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŸºé‡‘å®æ—¶ä¼°å€¼-å¯’æ¾ä¸ªäººç½‘é¡µç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <style>
        :root { --up: #ff4d4f; --down: #52c41a; --blue: #1890ff; --border: #e8e8e8; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; padding: 12px; margin: 0; }
        
        /* é¡¶éƒ¨çœ‹æ¿ */
        .summary-card { background: linear-gradient(135deg, #2f54eb, #1890ff); color: #fff; padding: 20px 15px; border-radius: 16px; margin-bottom: 16px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .sum-box { text-align: center; }
        .sum-label { font-size: 11px; opacity: 0.8; margin-bottom: 4px; }
        .sum-val { font-size: 19px; font-weight: bold; }
        
        /* æ“ä½œé¢æ¿ */
        .control-panel { background: #fff; border-radius: 12px; padding: 10px; margin-bottom: 16px; border: 1px solid var(--border); }
        .input-row { display: flex; align-items: center; width: 100%; height: 44px; }
        
        .inputs-part { flex: 1; display: flex; border: 1px solid var(--border); border-radius: 8px 0 0 8px; overflow: hidden; height: 100%; }
        .inputs-part input, .inputs-part select { flex: 1; width: 30%; border: none; border-right: 1px solid var(--border); outline: none; font-size: 13px; padding: 0 5px; text-align: center; }
        
        /* ä¿®å¤ç‚¹å‡»å“åº”çš„æ ¸å¿ƒæ ·å¼ */
        .btn-part { 
            width: 65px !important; 
            height: 100%; 
            background: var(--blue) !important; 
            border-radius: 0 8px 8px 0;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            flex-shrink: 0 !important;
            position: relative;
            z-index: 10; /* æé«˜å±‚çº§ */
        }
        
        .add-btn-final {
            color: #ffffff !important;
            font-size: 15px !important;
            font-weight: bold !important;
            background: transparent !important;
            border: none !important;
            width: 100% !important;
            height: 100% !important;
            display: flex !important; /* æ”¹ä¸º flex */
            align-items: center;
            justify-content: center;
            padding: 0 !important;
            margin: 0 !important;
            cursor: pointer;
            pointer-events: auto !important; /* ç¡®ä¿æ•è·ç‚¹å‡» */
        }

        /* åˆ—è¡¨å±•ç¤º */
        .asset-title { font-size: 13px; color: #666; margin: 10px 0 8px 5px; font-weight: bold; }
        .item-card { background: #fff; border-radius: 12px; padding: 15px; margin-bottom: 12px; border: 1px solid var(--border); }
        .item-head { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; gap: 10px; }
        .item-name { font-weight: bold; font-size: 15px; flex: 1; line-height: 1.4; }
        .item-btns { display: flex; flex-shrink: 0; }
        
        .card-row { display: flex; justify-content: space-between; font-size: 14px; margin-top: 5px; }
        .up { color: var(--up); }
        .down { color: var(--down); }
        .btn-s { padding: 4px 10px; border-radius: 4px; border: none; font-size: 12px; color: #fff; margin-left: 5px; white-space: nowrap; }

        /* å¼¹çª— */
        .mask { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:99; }
        .dialog { background:#fff; width:80%; border-radius:12px; padding:20px; text-align:center; }
        .dialog input { width:100%; height:40px; margin:15px 0; text-align:center; border:1px solid var(--blue); border-radius:4px; }
        .btn-act { width:100%; height:40px; background:var(--blue); color:#fff; border:none; border-radius:4px; font-weight:bold; }
    </style>
</head>
<body>

<div id="app">
    <div class="summary-card">
        <div class="sum-box"><div class="sum-label">ä¼°ç®—æ€»å¸‚å€¼</div><div class="sum-val">{{ totalAmount.toFixed(2) }}</div></div>
        <div class="sum-box"><div class="sum-label">ç´¯è®¡æ€»æŠ•å…¥</div><div class="sum-val">{{ totalCost.toFixed(2) }}</div></div>
        <div class="sum-box"><div class="sum-label">æŒä»“ç›ˆäº</div><div class="sum-val" :class="totalProfit>=0?'up':'down'">{{ totalProfit>=0?'+':'' }}{{ totalProfit.toFixed(2) }}</div></div>
        <div class="sum-box"><div class="sum-label">ä»Šæ—¥ç›ˆäº</div><div class="sum-val" :class="totalDayProfit>=0?'up':'down'">{{ totalDayProfit>=0?'+':'' }}{{ totalDayProfit.toFixed(2) }}</div></div>
    </div>

    <div class="control-panel">
        <div class="input-row">
            <div class="inputs-part">
                <input v-model="form.code" placeholder="ä»£ç " type="text">
                <input v-model.number="form.money" type="number" placeholder="é‡‘é¢">
                <select v-model="form.type">
                    <option value="åŸºé‡‘">åŸºé‡‘</option>
                    <option value="è‚¡ç¥¨">è‚¡ç¥¨</option>
                </select>
            </div>
            <div class="btn-part">
                <button class="add-btn-final" @click="addItem">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <div v-for="cat in ['åŸºé‡‘','è‚¡ç¥¨']" :key="cat" v-if="getGroup(cat).length">
        <div class="asset-title">{{cat}}èµ„äº§æ˜ç»†</div>
        <div v-for="item in getGroup(cat)" :key="item.code" class="item-card">
            <div class="item-head">
                <div class="item-name"><span style="color:#666; font-size:13px; font-weight:normal;">{{item.code}}</span> {{item.name}}</div>
                <div class="item-btns">
                    <button class="btn-s" style="background:var(--blue)" @click="openEdit(item)">ç¼–è¾‘</button>
                    <button class="btn-s" style="background:#ff4d4f" @click="confirmDelete(item)">åˆ é™¤</button>
                </div>
            </div>
            <div class="card-row">
                <span>æ¶¨è·Œï¼š<span :class="item.changeRate>=0?'up':'down'">{{item.changeRate>=0?'+':''}}{{item.changeRate}}%</span></span>
                <span>ç›ˆäºï¼š<span :class="getItemProfit(item)>=0?'up':'down'">{{getItemProfit(item)>=0?'+':''}}{{getItemProfit(item).toFixed(2)}}</span></span>
            </div>
            <div class="card-row" style="color:#888; font-size:12px;">
                <span>æŒæœ‰ï¼š{{item.cost}}</span>
                <span :style="{ color: getAdvice(item.changeRate).color, fontWeight: 'bold' }">æŒ‡ä»¤ï¼š{{getAdvice(item.changeRate).text}}</span>
            </div>
        </div>
    </div>

    <div class="mask" v-if="editData.show">
        <div class="dialog">
            <div style="font-weight:bold">{{editData.name}}</div>
            <input type="number" v-model.number="editData.tempValue">
            <button class="btn-act" @click="saveEdit">ç¡®å®šä¿®æ”¹</button>
            <button class="btn-act" style="background:#eee; color:#666; margin-top:10px;" @click="editData.show=false">å–æ¶ˆ</button>
        </div>
    </div>

    <div class="mask" v-if="delConfirm.show">
        <div class="dialog">
            <div style="font-weight:bold; color:red">ç¡®è®¤åˆ é™¤æ­¤èµ„äº§ï¼Ÿ</div>
            <p>{{delConfirm.name}}</p>
            <button class="btn-act" style="background:red" @click="executeDelete">ç¡®å®šåˆ é™¤</button>
            <button class="btn-act" style="background:#eee; color:#666; margin-top:10px;" @click="delConfirm.show=false">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<script>
const _0xkey = ['\x61\x73\x73\x65\x74\x73\x5f\x66\x69\x6e\x61\x6c\x5f\x76\x32']; 
new Vue({
    el: '#app',
    data: {
        form: { code: '', money: '', type: 'åŸºé‡‘' },
        assets: JSON.parse(localStorage.getItem(_0xkey[0]) || '{}'),
        fundList: [],
        editData: { show: false, code: '', name: '', tempValue: 0 },
        delConfirm: { show: false, code: '', name: '' }
    },
    computed: {
        totalAmount() { return this.fundList.reduce((s, i) => s + (i.price * i.myShare), 0); },
        totalCost() { return this.fundList.reduce((s, i) => s + i.cost, 0); },
        totalProfit() { return this.fundList.reduce((s, i) => s + (i.price * i.myShare - i.cost), 0); },
        totalDayProfit() { return this.fundList.reduce((s, i) => s + (i.dayProfit || 0), 0); }
    },
    mounted() { this.refreshAll(); setInterval(this.refreshAll, 10000); },
    methods: {
        getGroup(cat) { return this.fundList.filter(i => i.type === cat); },
        getItemProfit(item) { return item.price * item.myShare - item.cost; },
        
        getAdvice(rate) {
            if (rate <= -5.0) return { text: "ğŸ’ é»„é‡‘å‘(é‡ä»“)", color: "#092b00" }; 
            if (rate <= -3.2) return { text: "ğŸ¥¦ å›æ’¤æŠ„åº•(å…¥)", color: "#1d823e" };
            if (rate <= -1.8) return { text: "ğŸŸ¢ æ³¢æ®µä¹°ç‚¹(åŠ )", color: "#52c41a" };
            if (rate <= -0.8) return { text: "ğŸ”µ ç­–ç•¥å»ºä»“(è½»)", color: "#1890ff" };
            if (rate < 1.5 && rate > -0.8) return { text: "âšª ä¿¡å·ç­‰å¾…(æŒ)", color: "#888" };
            if (rate >= 1.5 && rate < 2.8) return { text: "ğŸŸ¡ è¶‹åŠ¿é¢„è­¦(è§‚)", color: "#faad14" };
            if (rate >= 2.8 && rate < 4.2) return { text: "ğŸš© æ³¢æ®µé«˜æŠ›(å‡)", color: "#ff7a45" };
            if (rate >= 4.2 && rate < 5.5) return { text: "âš¡ ç¥å¥‡åè½¬(æŠ›)", color: "#ff4d4f" };
            if (rate >= 5.5) return { text: "ğŸ”¥ è§é¡¶ä¿¡å·(ç¦»)", color: "#820014" };
            return { text: "âšª ä¿¡å·ç­‰å¾…(æŒ)", color: "#888" };
        },

        async fetchData(code, type) {
            try {
                if (type === 'åŸºé‡‘') {
                    return new Promise(res => {
                        window.jsonpgz = (d) => res({ name: d.name, price: parseFloat(d.gsz), changeRate: parseFloat(d.gszzl), prev: parseFloat(d.dwjz) });
                        const s = document.createElement('script');
                        s.src = `https://fundgz.1234567.com.cn/js/${code}.js?rt=${Date.now()}`;
                        document.body.appendChild(s); 
                        s.onerror = () => res(null); s.onload = () => s.remove();
                    });
                } else {
                    const r = await fetch(`https://hq.sinajs.cn/list=${code.toLowerCase()}`);
                    const t = await r.text();
                    const d = t.split('"')[1].split(',');
                    const p = parseFloat(d[3]), v = parseFloat(d[2]);
                    return { name: d[0], price: p, changeRate: parseFloat(((p-v)/v*100).toFixed(2)), prev: v };
                }
            } catch (e) { return null; }
        },
        async refreshAll() {
            const list = [];
            for (const code in this.assets) {
                const info = this.assets[code];
                const live = await this.fetchData(code, info.type);
                if (live) {
                    const cost = parseFloat(info.money);
                    const sh = cost / live.prev; 
                    list.push({ ...live, code, type: info.type, cost: cost, myShare: sh, dayProfit: (live.price - live.prev) * sh });
                }
            }
            this.fundList = list;
        },
        addItem() {
            // å¢åŠ ç©ºå€¼åˆ¤æ–­ç¡®ä¿æœ‰æ•ˆæ€§
            if(!this.form.code || this.form.money === "" || this.form.money === null) {
                alert("è¯·è¾“å…¥ä»£ç å’Œé‡‘é¢");
                return;
            }
            const code = this.form.code.trim();
            Vue.set(this.assets, code, { code: code, money: parseFloat(this.form.money), type: this.form.type });
            localStorage.setItem(_0xkey[0], JSON.stringify(this.assets));
            this.refreshAll();
            this.form.code = ''; this.form.money = '';
        },
        openEdit(item) { this.editData.code = item.code; this.editData.name = item.name; this.editData.tempValue = item.cost; this.editData.show = true; },
        saveEdit() {
            const nv = parseFloat(this.editData.tempValue);
            if (!isNaN(nv)) {
                this.assets[this.editData.code].money = nv;
                localStorage.setItem(_0xkey[0], JSON.stringify(this.assets));
                this.refreshAll(); this.editData.show = false;
            }
        },
        confirmDelete(item) { this.delConfirm.code = item.code; this.delConfirm.name = item.name; this.delConfirm.show = true; },
        executeDelete() {
            Vue.delete(this.assets, this.delConfirm.code);
            localStorage.setItem(_0xkey[0], JSON.stringify(this.assets));
            this.delConfirm.show = false; this.refreshAll();
        }
    }
});
</script>
</body>
</html>
